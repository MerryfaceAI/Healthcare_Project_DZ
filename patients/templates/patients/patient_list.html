{% extends "base_generic.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2>ðŸ“‹ Patient Registry</h2>
  <hr>

  <!-- Filter/Search Bar -->
  <form method="get" class="mb-4 row g-3">
    <div class="col-md-4">
      <input type="text" name="search_name" class="form-control" placeholder="Search by name..." value="{{ request.GET.search_name }}">
    </div>
    <div class="col-md-4">
      <input type="text" name="search_id" class="form-control" placeholder="Medical Record #" value="{{ request.GET.search_id }}">
    </div>
    <div class="col-md-2">
      <select name="page_size" class="form-select">
        {% for size in [10, 25, 50, 100] %}
          <option value="{{ size }}" {% if request.GET.page_size == size|stringformat:"s" %}selected{% endif %}>{{ size }} per page</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100">Search</button>
    </div>
  </form>

  <!-- Patient Table -->
  <div class="table-responsive">
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>MRN</th>
          <th>Name</th>
          <th>DOB</th>
          <th>Gender</th>
          <th>Contact</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for patient in patients %}
        <tr>
          <td>{{ patient.medical_record_number }}</td>
          <td>{{ patient.first_name }} {{ patient.last_name }}</td>
          <td>{{ patient.date_of_birth }}</td>
          <td>{{ patient.get_gender_display }}</td>
          <td>{{ patient.contact.phone }}</td>
          <td>
            <a href="{% url 'patients:patient_detail' patient.pk %}" class="btn btn-sm btn-info">View</a>
            <a href="{% url 'patients:edit_patient' patient.pk %}" class="btn btn-sm btn-secondary">Edit</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="text-center">No patients found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav>
    <ul class="pagination justify-content-center">
      {% if patients.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ patients.previous_page_number }}&{{ request.GET.urlencode }}">Previous</a></li>
      {% endif %}

      <li class="page-item active"><span class="page-link">{{ patients.number }}</span></li>

      {% if patients.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ patients.next_page_number }}&{{ request.GET.urlencode }}">Next</a></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
