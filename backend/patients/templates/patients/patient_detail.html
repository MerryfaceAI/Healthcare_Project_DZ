{% extends "base_generic.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2>🧑‍⚕️ Patient Profile: {{ patient.first_name }} {{ patient.last_name }}</h2>
  <hr>

  <div class="row mb-4">
    <div class="col-md-6">
      <h5>🔹 Basic Information</h5>
      <ul class="list-group">
        <li class="list-group-item"><strong>MRN:</strong> {{ patient.medical_record_number }}</li>
        <li class="list-group-item"><strong>Date of Birth:</strong> {{ patient.date_of_birth }}</li>
        <li class="list-group-item"><strong>Gender:</strong> {{ patient.get_gender_display }}</li>
        <li class="list-group-item"><strong>Created At:</strong> {{ patient.created_at }}</li>
      </ul>
    </div>
    <div class="col-md-6">
      <h5>📞 Contact</h5>
      <ul class="list-group">
        <li class="list-group-item"><strong>Phone:</strong> {{ patient.contact.phone }}</li>
        <li class="list-group-item"><strong>Email:</strong> {{ patient.contact.email }}</li>
        <li class="list-group-item"><strong>Address:</strong> {{ patient.address }}</li>
      </ul>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-6">
      <h5>🚑 Emergency Contact</h5>
      <ul class="list-group">
        <li class="list-group-item"><strong>Name:</strong> {{ patient.emergency_contact.name }}</li>
        <li class="list-group-item"><strong>Relationship:</strong> {{ patient.emergency_contact.relationship }}</li>
        <li class="list-group-item"><strong>Phone:</strong> {{ patient.emergency_contact.phone }}</li>
      </ul>
    </div>
    <div class="col-md-6">
      <h5>💳 Insurance</h5>
      <ul class="list-group">
        <li class="list-group-item"><strong>Provider:</strong> {{ patient.insurance.provider }}</li>
        <li class="list-group-item"><strong>Policy #:</strong> {{ patient.insurance.policy_number }}</li>
        <li class="list-group-item"><strong>Group #:</strong> {{ patient.insurance.group_number }}</li>
        <li class="list-group-item"><strong>Valid Until:</strong> {{ patient.insurance.valid_until }}</li>
      </ul>
    </div>
  </div>

  <hr>

  <div class="row mb-4">
    <div class="col-md-6">
      <h5>🩺 Conditions</h5>
      <ul class="list-group">
        {% for condition in patient.condition_set.all %}
        <li class="list-group-item">
          {{ condition.name }} — Onset: {{ condition.onset_date }}
        </li>
        {% empty %}
        <li class="list-group-item">No recorded conditions.</li>
        {% endfor %}
      </ul>
    </div>
    <div class="col-md-6">
      <h5>🧪 Allergies</h5>
      <ul class="list-group">
        {% for allergy in patient.allergy_set.all %}
        <li class="list-group-item">
          {{ allergy.substance }} — {{ allergy.severity }}
        </li>
        {% empty %}
        <li class="list-group-item">No known allergies.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-6">
      <h5>💉 Immunizations</h5>
      <ul class="list-group">
        {% for imm in patient.immunization_set.all %}
        <li class="list-group-item">
          {{ imm.vaccine }} — {{ imm.date_given }}
        </li>
        {% empty %}
        <li class="list-group-item">No immunizations recorded.</li>
        {% endfor %}
      </ul>
    </div>
    <div class="col-md-6">
      <h5>💊 Medications</h5>
      <ul class="list-group">
        {% for rx in patient.prescription_set.all %}
        <li class="list-group-item">
          {{ rx.medication }} — {{ rx.dosage }}
        </li>
        {% empty %}
        <li class="list-group-item">No prescriptions available.</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="d-flex justify-content-between">
    <a href="{% url 'patients:edit_patient' patient.pk %}" class="btn btn-warning">✏️ Edit Patient</a>
    <a href="{% url 'patients:patient_pdf' pk=patient.pk %}" class="btn btn-outline-info">🖨️ Export PDF</a>
    <a href="{% url 'patients:patient_list' %}" class="btn btn-secondary">← Back to List</a>
  </div>
</div>
{% endblock %}
