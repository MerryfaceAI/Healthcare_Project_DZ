{% if patients %}
  <table class="table table-striped table-hover mb-0">
    <thead class="table-light">
      <tr>
        <th scope="col" style="width: 20%;">Name</th>
        <th scope="col" style="width: 25%;">Email</th>
        <th scope="col" style="width: 10%;">Age</th>
        <th scope="col" style="width: 25%;">Brief Medical History</th>
        <th scope="col" style="width: 20%; text-align: center;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for patient in patients %}
        <tr>
          <td><a href="{% url 'patients:patient_detail' patient.id %}" class="fw-bold" style="color: #35424a;">{{ patient.name }}</a></td>
          <td>{{ patient.email }}</td>
          <td>{{ patient.age }}</td>
          <td>
            {% if patient.medical_history %}
              {{ patient.medical_history|truncatewords:10 }}
            {% else %}
              <span class="text-muted fst-italic">No history provided</span>
            {% endif %}
          </td>
          <td style="text-align: center;">
            <a href="{% url 'patients:patient_detail' patient.id %}" class="btn btn-outline-primary btn-sm me-1" title="View Details">
              <i class="fas fa-eye"></i>
            </a>
            <a href="{% url 'patients:edit_patient' patient.id %}" class="btn btn-outline-warning btn-sm me-1" title="Edit Patient" style="color: #35424a;">
              <i class="fas fa-edit"></i>
            </a>
            <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deletePatientModal-{{ patient.id }}" title="Delete Patient">
              <i class="fas fa-trash-alt"></i>
            </button>
            <div class="modal fade" id="deletePatientModal-{{ patient.id }}" tabindex="-1" aria-labelledby="deleteModalLabel-{{ patient.id }}" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content rounded shadow-sm">
                  <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteModalLabel-{{ patient.id }}">Confirm Delete</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    Are you sure you want to delete the patient: <strong>{{ patient.name }}</strong>?<br>
                    This action cannot be undone.
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
                    <form method="post" action="{% url 'patients:delete_patient' patient.id %}" class="d-inline">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-danger btn-sm">Yes, Delete</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if page_obj %}
  <div class="p-3">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <label class="me-2">Rows per page:</label>
        <select id="itemsPerPage" class="form-select form-select-sm d-inline-block" style="width: auto;">
          <option value="10" {% if page_size|stringformat:"s" == "10" %}selected{% endif %}>10</option>
          <option value="25" {% if page_size|stringformat:"s" == "25" %}selected{% endif %}>25</option>
          <option value="50" {% if page_size|stringformat:"s" == "50" %}selected{% endif %}>50</option>
        </select>
      </div>
      <nav aria-label="Table pagination">
        <ul class="pagination pagination-sm mb-0">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link page-nav" href="?page=1" data-page="1">« First</a>
            </li>
            <li class="page-item">
              <a class="page-link page-nav" href="?page={{ page_obj.previous_page_number }}" data-page="{{ page_obj.previous_page_number }}">Previous</a>
            </li>
          {% endif %}

          <li class="page-item disabled"><a class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</a></li>

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link page-nav" href="?page={{ page_obj.next_page_number }}" data-page="{{ page_obj.next_page_number }}">Next</a>
            </li>
            <li class="page-item">
              <a class="page-link page-nav" href="?page={{ page_obj.paginator.num_pages }}" data-page="{{ page_obj.paginator.num_pages }}">Last »</a>
            </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
  {% endif %}
{% else %}
  <div class="p-3 text-center">
    <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
    <p class="text-muted">No patients found matching your criteria.</p>
  </div>
{% endif %}